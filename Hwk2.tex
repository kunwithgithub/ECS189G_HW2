\documentclass[11pt]{article} 
\setlength{\oddsidemargin}{0.0in}
\setlength{\evensidemargin}{0.0in}
\setlength{\topmargin}{-0.25in}
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textwidth}{6.5in}
\setlength{\textheight}{9.25in}
\setlength{\parindent}{0in}
\setlength{\parskip}{2mm}
\newcommand\tab[1][0.5cm]{\hspace*{#1}}
\usepackage{listings}
\usepackage{amsmath,amsfonts,amsthm, amssymb} % Math packages
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{comment}

\title{ECS 189G Homework 2}
\author{Bochao Xin, Dianfeng Jiang, Melissa Goh, Shikun Huang}
\date{Due: 24 February 2020 (Monday)}

\begin{document}

\maketitle

\section{lm Model}
\subsection{Movienum}
Movienum will be our first predictor. But directly using movienum 
in lm function does not seem very promising, because movienum 
itself is only IDs for different movies and logically does not 
directly affect users' rating. Instead, we use movienum to 
calculate average rating of each individual movie. Then, we define 
movies with average ratings greater than or equal to 4.0 as 
"best movies" and define movies with average ratings less than or 
equal to 3.5 as "worst movies". Below is the code we used to do 
this job:
\begin{verbatim}
  # transform movienum to factor
  mov_factor <- as.factor(u.big$movienum) 
  levels <- levels(mov_factor)
  mov <- matrix(0,nrow = length(levels),ncol = 3)
  for (i in 1:length(levels)) {
    # find all the rows concerning the same movie
    movX <- u.big[mov_factor == levels[i],]
    average_rate <- mean(movX$rating)
    
    mov[i,1] <- as.numeric(levels[i])
    if(average_rate >= 4.0)
      mov[i,2] <- 1
    if(average_rate <= 3.5)
      mov[i,3] <- 1
  }
  mov <- as.data.frame(mov)
  names(mov) <- c("movienum","best_movie","worst_movie")
  
  # merge it back to data frame u.big later
  u.big <- merge(u.big, mov, by = "movienum", all.x = TRUE)
\end{verbatim}

Why did we do this? It comes from the intuition that some movies 
are just better than others. Those movies of high quality should 
receive higher scores than those of low quality. If most users 
speak highly of a certain movie, it proves that this movie is of 
high quality and tends to receive higher scores from future users, 
and vice versa.

\subsection{Usernum}
Our second predictor will be usernum. The way that we used to 
approach usernum is very similar to what we did for movienum. We 
use usernum to calculate average rating given by each individual 
user. Then, we define users who give average ratings less than or 
equal to 3.0 as "tough person" and define those who give average 
ratings greater than or equal to 4.0 as "nice person". Below is the 
code we used:
\begin{verbatim}
  usr_factor <- as.factor(u.big$usernum)
  levels <- levels(usr_factor)
  usr <- matrix(0,nrow=length(levels),ncol = 3)
  for (i in 1:length(levels)) {
    usrX <- u.big[usr_factor == levels[i],]
    average_rate <- mean(usrX$rating)
    usr[i,1] <- as.numeric(levels[i])
    
    if(average_rate >= 4.0)
      usr[i,2] <- 1
    if(average_rate <= 3.0)
      usr[i,3] <- 1
  }
  usr <- as.data.frame(usr)
  names(usr) <- c("usernum","nice_person","tough_person")
  u.big <- merge(u.big, usr, by = "usernum", all.x = TRUE)
\end{verbatim}

We did this based on the assumption that some users are just 
harsher than others, and they tend to give relative low ratings for 
movies they have seen. Also, some users are just more lenient than 
the ordinary, and they tend to give relative high ratings for 
movies.

\subsection{Genres}
Different kinds of movies should affect their ratings. Our first 
attempt is to use all genres as predictors. Below is the result:
\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr(u.big, predictors)), data = u.big.trn)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.1872 -0.6248  0.2613  0.6814  2.1056 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  3.383414   0.011023 306.929  < 2e-16 ***
unknown     -0.272303   0.369749  -0.736 0.461457    
Action      -0.085943   0.010808  -7.952 1.86e-15 ***
Adventure    0.080097   0.012636   6.339 2.33e-10 ***
Animation    0.353127   0.024639  14.332  < 2e-16 ***
Children    -0.219328   0.018535 -11.833  < 2e-16 ***
Comedy      -0.064776   0.010340  -6.265 3.75e-10 ***
Crime        0.087370   0.013776   6.342 2.27e-10 ***
Documentary  0.250434   0.042608   5.878 4.18e-09 ***
Drama        0.241360   0.010050  24.017  < 2e-16 ***
Fantasy     -0.204901   0.033054  -6.199 5.71e-10 ***
FilmNoir     0.392378   0.029256  13.412  < 2e-16 ***
Horror      -0.132379   0.016954  -7.808 5.85e-15 ***
Musical      0.066690   0.018914   3.526 0.000422 ***
Mystery      0.114597   0.017160   6.678 2.43e-11 ***
Romance      0.113899   0.009462  12.037  < 2e-16 ***
SciFi        0.095209   0.012179   7.818 5.44e-15 ***
Thriller     0.019249   0.010444   1.843 0.065324 .  
War          0.258046   0.013124  19.663  < 2e-16 ***
Western      0.190491   0.027305   6.976 3.05e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.109 on 94980 degrees of freedom
Multiple R-squared:  0.03026,	Adjusted R-squared:  0.03007 
F-statistic:   156 on 19 and 94980 DF,  p-value: < 2.2e-16

[1] 0.8778 # MAPE
\end{verbatim}

We can see from the above that not all genres has a great impact on
users' ratings. For example: the coefficient of "Action" movie is 
only $-0.0859$, meaning that whether a movie is action or not will
not affect people's ratings very much. Therefore, we could safely 
remove some genres from our predictors while preserving the 
accuracy of our predictions. Below are all the genres we 
included in our final lm model.
\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr(u.big, predictors)), data = u.big.trn)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.1460 -0.6262  0.2683  0.6501  2.0426 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  3.349864   0.006310 530.882  < 2e-16 ***
unknown     -0.238753   0.369962  -0.645    0.519    
Animation    0.377991   0.023603  16.015  < 2e-16 ***
Children    -0.188422   0.017653 -10.673  < 2e-16 ***
Documentary  0.282196   0.041782   6.754 1.45e-11 ***
Drama        0.276385   0.007848  35.218  < 2e-16 ***
Fantasy     -0.204048   0.032897  -6.203 5.58e-10 ***
FilmNoir     0.457673   0.028405  16.112  < 2e-16 ***
Horror      -0.117394   0.016462  -7.131 1.00e-12 ***
Mystery      0.140822   0.016722   8.421  < 2e-16 ***
Romance      0.105400   0.009358  11.263  < 2e-16 ***
SciFi        0.098830   0.011449   8.632  < 2e-16 ***
War          0.245364   0.012829  19.126  < 2e-16 ***
Western      0.169018   0.027010   6.258 3.93e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.11 on 94986 degrees of freedom
Multiple R-squared:  0.0285,	Adjusted R-squared:  0.02837 
F-statistic: 214.4 on 13 and 94986 DF,  p-value: < 2.2e-16

[1] 0.8778 # MAPE
\end{verbatim}

We found that even if we remove 6 different genres from our 
predictors, MAPE does not change.

\subsection{Occupations}
Our intuition to predicting ratings is based on factors that fundamentally represent the user's
personality. Some features we considered are age, usernum, and occupation. To elaborate on this,
we think that including usernum as a feature would let us know their rating based on how harshly
or leniently a user rates their movies, based on their user ID. 

\begin{figure}[ht!]
\begin{center}
\includegraphics[width=0.8\textwidth]{ratingxocc.png}
\caption{Average Rating vs. Occupation}
\end{center}
\end{figure}

Intuitively, occupation reflects a person's personality. We plotted 
the average rating given by each occupation. As shown in the plot, 
the ratings are not very uniform, which would probably make 
Occupation a good feature to predict ratings. 
Our first attempt is simply using all occupations as our 
predictors. Here is the result.
\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr(u.big, predictors)), data = u.big.trn)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7801 -0.5709  0.3527  0.5637  2.1075 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)        3.37842    0.01541 219.192  < 2e-16 ***
occ.administrator  0.25732    0.02034  12.649  < 2e-16 ***
occ.artist         0.26887    0.02836   9.480  < 2e-16 ***
occ.doctor         0.29994    0.05169   5.803 6.54e-09 ***
occ.educator       0.28936    0.01941  14.911  < 2e-16 ***
occ.engineer       0.16349    0.01995   8.194 2.56e-16 ***
occ.entertainment  0.05785    0.02944   1.965  0.04941 *  
occ.executive     -0.04073    0.02503  -1.627  0.10370    
occ.healthcare    -0.48588    0.02655 -18.299  < 2e-16 ***
occ.homemaker     -0.09729    0.06842  -1.422  0.15505    
occ.lawyer         0.36098    0.03489  10.345  < 2e-16 ***
occ.librarian      0.18277    0.02206   8.283  < 2e-16 ***
occ.marketing      0.10166    0.03016   3.371  0.00075 ***
occ.none           0.40169    0.04121   9.748  < 2e-16 ***
occ.other          0.16639    0.01899   8.763  < 2e-16 ***
occ.programmer     0.19248    0.02016   9.548  < 2e-16 ***
occ.retired        0.09592    0.03254   2.947  0.00321 ** 
occ.salesman       0.20450    0.04222   4.843 1.28e-06 ***
occ.scientist      0.23405    0.02960   7.908 2.64e-15 ***
occ.student        0.13405    0.01724   7.774 7.70e-15 ***
occ.technician     0.15457    0.02474   6.248 4.18e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.117 on 94979 degrees of freedom
Multiple R-squared:  0.01505,	Adjusted R-squared:  0.01484 
F-statistic: 72.55 on 20 and 94979 DF,  p-value: < 2.2e-16

[1] 0.8798 # MAPE
\end{verbatim}

Comparing this with Figure 1, we believe that ratings given by 
people of different occupations are around the same. But there are
two special cases. First, healthcare workers tend to give relative
low ratings compared to other occupations. Second, people whose 
occupation is none tend to give relative high ratings. Therefore,
the only two occupations we used as predictors are "healthcare" and
"none." Below is the result.
\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr(u.big, predictors)), data = u.big.trn)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7801 -0.5441  0.4559  0.4559  2.1075 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     3.544111   0.003704 956.716  < 2e-16 ***
occ.healthcare -0.651561   0.021993 -29.626  < 2e-16 ***
occ.none        0.236006   0.038496   6.131 8.78e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.12 on 94997 degrees of freedom
Multiple R-squared:  0.009606,	Adjusted R-squared:  0.009585 
F-statistic: 460.7 on 2 and 94997 DF,  p-value: < 2.2e-16

[1] 0.8694 # MAPE
\end{verbatim}
We could see that using these two occupations as our predictors 
actually improves our result.
 
Since age likely affects
the kind of occupation a person has, we decided to use the interaction term `age` and `occ` to predicting
ratings. The MAPE obtained from this set of features is 0.8752.

\begin{verbatim}
    > lmout <- lm(rating ~ age*occ, data=trnSet)
    summary(lmout)
    > summary(lmout)
    
    Call:
    lm(formula = rating ~ age * occ, data = trnSet)
    
    Residuals:
        Min      1Q  Median      3Q     Max 
    -3.5559 -0.5763  0.3376  0.5374  2.8331 
    
    Coefficients:
                           Estimate Std. Error t value Pr(>|t|)    
    (Intercept)           3.3457294  0.0523707  63.885  < 2e-16 ***
    age                   0.0073463  0.0012955   5.670 1.43e-08 ***
    occartist            -0.6775732  0.1078113  -6.285 3.30e-10 ***
    occdoctor            -0.1125594  0.1831937  -0.614 0.538934    
    occeducator           0.3647334  0.0734661   4.965 6.89e-07 ***
    occengineer          -0.0359133  0.0688078  -0.522 0.601716    
    occentertainment      0.6526975  0.1318031   4.952 7.36e-07 ***
    occexecutive         -1.3817756  0.0913665 -15.123  < 2e-16 ***
    occhealthcare        -2.1325458  0.0901122 -23.665  < 2e-16 ***
    occhomemaker         -0.3012994  0.2346490  -1.284 0.199130    
    occlawyer             0.0806203  0.1262801   0.638 0.523199    
    occlibrarian          0.0534024  0.0785553   0.680 0.496629    
    occmarketing          0.3054019  0.1264570   2.415 0.015734 *  
    occnone               0.5380508  0.1263167   4.260 2.05e-05 ***
    occother              0.1970186  0.0646248   3.049 0.002299 ** 
    occprogrammer        -0.0590576  0.0695120  -0.850 0.395548    
    occretired           -0.3376369  0.4328787  -0.780 0.435404    
    occsalesman           0.1159735  0.1359053   0.853 0.393473    
    occscientist         -0.0424774  0.1416788  -0.300 0.764319    
    occstudent            0.2005008  0.0630880   3.178 0.001483 ** 
    occtechnician         0.2030625  0.0863610   2.351 0.018709 *  
    occwriter            -0.8011493  0.0768054 -10.431  < 2e-16 ***
    age:occartist         0.0247203  0.0032503   7.606 2.86e-14 ***
    age:occdoctor         0.0056768  0.0049181   1.154 0.248394    
    age:occeducator      -0.0083699  0.0017469  -4.791 1.66e-06 ***
    age:occengineer      -0.0007054  0.0017976  -0.392 0.694775    
    age:occentertainment -0.0267839  0.0043092  -6.216 5.14e-10 ***
    age:occexecutive      0.0302180  0.0023624  12.791  < 2e-16 ***
    age:occhealthcare     0.0360066  0.0022189  16.227  < 2e-16 ***
    age:occhomemaker      0.0009872  0.0068782   0.144 0.885874    
    age:occlawyer         0.0013949  0.0034506   0.404 0.686035    
    age:occlibrarian     -0.0031238  0.0019904  -1.569 0.116554    
    age:occmarketing     -0.0116446  0.0033326  -3.494 0.000476 ***
    age:occnone          -0.0114218  0.0045476  -2.512 0.012021 *  
    age:occother         -0.0071173  0.0017077  -4.168 3.08e-05 ***
    age:occprogrammer     0.0014500  0.0018701   0.775 0.438121    
    age:occretired        0.0001103  0.0070637   0.016 0.987546    
    age:occsalesman      -0.0038728  0.0037978  -1.020 0.307855    
    age:occscientist      0.0012039  0.0038758   0.311 0.756089    
    age:occstudent       -0.0085517  0.0020196  -4.234 2.29e-05 ***
    age:occtechnician    -0.0079412  0.0024493  -3.242 0.001186 ** 
    age:occwriter         0.0168032  0.0020383   8.244  < 2e-16 ***
    ---
    Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
    
    Residual standard error: 1.109 on 94958 degrees of freedom
    Multiple R-squared:  0.02956,   Adjusted R-squared:  0.02914 
    F-statistic: 70.54 on 41 and 94958 DF,  p-value: < 2.2e-16
\end{verbatim}

\subsection{Interaction Terms}
We also explore some interaction terms. We think people of 
different occupations might have different preference for movies.
For example, artists might prefer drama and musical, and technician
might prefer science fiction. Therefoer, using interaction terms 
of occupations and genres might help us improve the accuracy of 
our prediction.

\clearpage
The first interaction term we include is $\textbf{executive} * \textbf{comedy}$.
\begin{figure}[ht!]
\begin{center}
\includegraphics[width=\textwidth]{comedy_occ.png}
\caption{Average Rating for Comedy vs. Occupations}
\end{center}
\end{figure}

From the above plot, we find that executives tend to give low 
ratings for comedy. Therefore, we want to use $\textbf{executive} * \textbf{comedy}$ as 
one of interaction terms in our lm model.

The second interaction term we include is $\textbf{student} * \textbf{mystery}$.
\begin{figure}[ht!]
\begin{center}
\includegraphics[width=\textwidth]{mystrey_student.png}
\caption{Average Rating for Mystery vs. Occupations}
\end{center}
\end{figure}

From the above plot, we find that students tend to give low 
ratings for mystery. Therefore, we want to use $\textbf{student} * \textbf{mystery}$ as one of interaction terms in our lm model.
\clearpage

Other interaction terms we include are $\textbf{artist} * \textbf{Sci-Fi}$ and $\textbf{writer} * \textbf{Sci-Fi}$.
\begin{figure}[ht!]
\begin{center}
\includegraphics[width=\textwidth]{sci_fi.png}
\caption{Average Rating for Sci-Fi vs. Occupations}
\end{center}
\end{figure}
We figure out that artists give rather high ratings for science 
ficiton, while writers give rather low ratings for it. We expect
there will be a positive coefficient for $\textbf{artist} * \textbf{Sci-Fi}$ and a negative coefficient for $\textbf{writer} * \textbf{Sci-Fi}$.

The last interaction term we included is $\textbf{writer} * \textbf{Action}$.
\begin{figure}[ht!]
\begin{center}
\includegraphics[width=\textwidth]{action.png}
\caption{Average Rating for Action Movies vs. Occupations}
\end{center}
\end{figure}
Writers tend to give quite low ratings for action movies. 
Therefore, using $\textbf{writer} * \textbf{Action}$ as interaction
term is highly likely to improve the accuracy of lm model.

\subsection{Final lm Model}
Our final model for lm will use usernum, movienum, some genres of 
movies, occupation of healthcare, occupation of none, and the above 
interaction terms as predictors. Below is the result of lm model. 
MAPE of this final model is 0.7446.

\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr(u.big, predictors)), data = u.big.trn)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.8027 -0.7197 -0.0117  0.8376  3.0302 

Coefficients:
                   Estimate Std. Error t value Pr(>|t|)    
(Intercept)       3.7036324  0.0076163 486.274  < 2e-16 ***
unknown           0.5043573  0.3282400   1.537  0.12441    
Animation         0.1714472  0.0209889   8.168 3.16e-16 ***
Children         -0.1277080  0.0156900  -8.139 4.02e-16 ***
Documentary       0.0707132  0.0371344   1.904  0.05688 .  
Drama             0.0621791  0.0072294   8.601  < 2e-16 ***
Fantasy           0.0007598  0.0290901   0.026  0.97916    
FilmNoir          0.0254993  0.0258373   0.987  0.32368    
Horror           -0.0290689  0.0146480  -1.985  0.04720 *  
Mystery           0.0556986  0.0165068   3.374  0.00074 ***
Romance           0.0373975  0.0083367   4.486 7.27e-06 ***
SciFi             0.0294848  0.0105000   2.808  0.00498 ** 
War               0.0294362  0.0116348   2.530  0.01141 *  
Western           0.0940044  0.0239513   3.925 8.69e-05 ***
occ.healthcare   -0.2450486  0.0200063 -12.249  < 2e-16 ***
occ.none          0.4087876  0.0338730  12.068  < 2e-16 ***
executive_comedy -0.2558763  0.0333103  -7.682 1.59e-14 ***
student_mystrery  0.0224079  0.0355071   0.631  0.52799    
artist_SciFi      0.0346920  0.0579341   0.599  0.54930    
writer_SciFi     -0.0525257  0.0442267  -1.188  0.23498    
writer_action    -0.0963854  0.0314375  -3.066  0.00217 ** 
best_movie        0.3737968  0.0094795  39.432  < 2e-16 ***
worst_movie      -0.6264494  0.0073858 -84.818  < 2e-16 ***
nice_person       0.5612674  0.0098445  57.013  < 2e-16 ***
tough_person     -0.7346390  0.0110443 -66.517  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.9845 on 94975 degrees of freedom
Multiple R-squared:  0.2359,	Adjusted R-squared:  0.2357 
F-statistic:  1222 on 24 and 94975 DF,  p-value: < 2.2e-16

[1] 0.7446

\end{verbatim}
\section{nmf model}
\tab{}In the nmf model, we input usernum, movienum, and rating as the input of the training set of the recosystem()'s \$train() function.
\\*
\tab{}We ran the \$train() function once with default tuning parameters beside the nmf = TRUE because we want the function to use nmf method instead of svd, and we want to see the MAPE() result with default settings so we could have a standard later on when we tune it.
\\*
\tab{}The MAPE() result for the nmf model is 0.7329318, which is not really "bad" consider it is already lower than our best lm model.
\\*
\tab{}To inrease the accuracy, we first tried different \textbf{\underline{dim}}, and see how the MAPE() result changed. We noticed that there would be an "optimal" number within a region, like a "local" optimize point so the result would be the lowest. Considering the rule of thumb that $p << \sqrt{n}$, we choose dim=25, as it improve the MAPE() result for 0.01 compared to the default one.
\\*
\tab{}Then, we tried different \textbf{\underline{niter}} since we discover the accuracy will increase as this parameter increase. But there is a asymptomatic ceiling for this parameter, which the improvement would not be noticeable or even could decrease the accuracy if we keep increasing it. Thus, after we played around with it, we set niter=80 as it improve our result for another 0.01.
\\*
\tab{}At last, our final nmf model's MAPE() result is 0.7139921 which improve by 0.02 compares to the original model with default tuning parameter.
\\*
\tab{}In addition, we also tried plugging in different predictors to user\_index and item\_index to see what happens to the predicting results. But the accuracy of the combinations we have tested are all worse than the original one with usernum and movienum. Thus, we still stick to our previous best model.









\section*{Appendix}
\subsection*{A lm model}
\subsubsection{A.1 Pure Independent Models}

\subsubsection*{A.2 Models with Covariates}
\paragraph{A.2.1 Age$*$occ}

\begin{verbatim}
Call:
lm(formula = rating ~ age * occ, data = u.big.trn)
Coefficients:
         (Intercept)                   age             occartist             occdoctor  
           3.3457294             0.0073463            -0.6775732            -0.1125594  
         occeducator           occengineer      occentertainment          occexecutive  
           0.3647334            -0.0359133             0.6526975            -1.3817756  
       occhealthcare          occhomemaker             occlawyer          occlibrarian  
          -2.1325458            -0.3012994             0.0806203             0.0534024  
        occmarketing               occnone              occother         occprogrammer  
           0.3054019             0.5380508             0.1970186            -0.0590576  
          occretired           occsalesman          occscientist            occstudent  
          -0.3376369             0.1159735            -0.0424774             0.2005008  
       occtechnician             occwriter         age:occartist         age:occdoctor  
           0.2030625            -0.8011493             0.0247203             0.0056768  
     age:occeducator       age:occengineer  age:occentertainment      age:occexecutive  
          -0.0083699            -0.0007054            -0.0267839             0.0302180  
   age:occhealthcare      age:occhomemaker         age:occlawyer      age:occlibrarian  
           0.0360066             0.0009872             0.0013949            -0.0031238  
    age:occmarketing           age:occnone          age:occother     age:occprogrammer  
          -0.0116446            -0.0114218            -0.0071173             0.0014500  
      age:occretired       age:occsalesman      age:occscientist        age:occstudent  
           0.0001103            -0.0038728             0.0012039            -0.0085517  
   age:occtechnician         age:occwriter  
          -0.0079412             0.0168032  
\end{verbatim}


\paragraph{A.2.2 Age$*$Gender}
\begin{verbatim}
Call:
lm(formula = rating ~ age * dum_gen.F, data = u.big.trn)
Coefficients:
  (Intercept)            age      dum_gen.F  age:dum_gen.F  
    3.3512072      0.0053591      0.0303178     -0.0007553 
\end{verbatim}


\paragraph{A.2.3 movienum+usernum+genre+age$*$occ}
\begin{verbatim}
    Call:
lm(formula = as.formula(indexToStr3(u.big, c(1, 2, 9:28), 5, 
    c(29:48))), data = u.big.trn)
Coefficients:
              (Intercept)                   movienum                    usernum  
                2.871e+00                 -6.169e-04                 -1.763e-05  
                  unknown                     Action                  Adventure  
               -3.004e-01                 -1.365e-01                  6.568e-02  
                Animation                   Children                     Comedy  
                3.160e-01                 -2.639e-01                 -1.191e-01  
                    Crime                Documentary                      Drama  
               -1.454e-02                  3.287e-01                  1.934e-01  
                  Fantasy                   FilmNoir                     Horror  
               -7.335e-02                  4.129e-01                 -1.593e-01  
                  Musical                    Mystery                    Romance  
                1.462e-02                  8.864e-02                  9.009e-02  
                    SciFi                   Thriller                        War  
               -9.738e-03                 -8.634e-03                  1.878e-01  
                  Western                  dum_gen.F                        age  
                1.147e-01                  6.444e-02                  2.085e-02  
    dum_occ.administrator             dum_occ.artist             dum_occ.doctor  
                6.942e-01                  1.401e-01                  5.213e-01  
         dum_occ.educator           dum_occ.engineer      dum_occ.entertainment  
                9.816e-01                  6.605e-01                  1.369e+00  
        dum_occ.executive         dum_occ.healthcare          dum_occ.homemaker  
               -4.614e-01                 -1.263e+00                  5.101e-01  
           dum_occ.lawyer          dum_occ.librarian          dum_occ.marketing  
                9.730e-01                  7.088e-01                  9.007e-01  
             dum_occ.none              dum_occ.other         dum_occ.programmer  
                1.387e+00                  9.364e-01                  6.820e-01  
          dum_occ.retired           dum_occ.salesman          dum_occ.scientist  
                7.286e-01                  9.490e-01                  5.339e-01  
          dum_occ.student         dum_occ.technician  age:dum_occ.administrator  
                9.896e-01                  9.035e-01                 -1.456e-02  
       age:dum_occ.artist         age:dum_occ.doctor       age:dum_occ.educator  
                5.738e-03                 -6.614e-03                 -2.104e-02  
     age:dum_occ.engineer  age:dum_occ.entertainment      age:dum_occ.executive  
               -1.462e-02                 -4.069e-02                  1.112e-02  
   age:dum_occ.healthcare      age:dum_occ.homemaker         age:dum_occ.lawyer  
                1.849e-02                 -1.681e-02                 -1.823e-02  
    age:dum_occ.librarian      age:dum_occ.marketing           age:dum_occ.none  
               -1.721e-02                 -2.367e-02                 -2.955e-02  
        age:dum_occ.other     age:dum_occ.programmer        age:dum_occ.retired  
               -2.260e-02                 -1.325e-02                 -1.949e-02  
     age:dum_occ.salesman      age:dum_occ.scientist        age:dum_occ.student  
               -2.208e-02                 -1.081e-02                 -2.567e-02  
   age:dum_occ.technician  
               -2.213e-02  
> MAPE(res, u.big.tstY)
[1] 0.8759136
\end{verbatim}


\paragraph{A.2.4 movienum+usernum+genre+age$*$occ(filtered)}
\begin{verbatim}
> ty <- lmout$coefficients[which(lmout$coefficients>0.1)]
> ty
          (Intercept)             Animation           Documentary                 Drama 
            2.8709570             0.3160384             0.3287317             0.1934401 
             FilmNoir                   War               Western dum_occ.administrator 
            0.4129342             0.1877643             0.1146586             0.6941661 
       dum_occ.artist        dum_occ.doctor      dum_occ.educator      dum_occ.engineer 
            0.1401388             0.5212673             0.9816013             0.6605198 
dum_occ.entertainment     dum_occ.homemaker        dum_occ.lawyer     dum_occ.librarian 
            1.3692947             0.5100636             0.9730293             0.7088333 
    dum_occ.marketing          dum_occ.none         dum_occ.other    dum_occ.programmer 
            0.9006979             1.3874222             0.9364326             0.6820366 
      dum_occ.retired      dum_occ.salesman     dum_occ.scientist       dum_occ.student 
            0.7285785             0.9489834             0.5338967             0.9896029 
   dum_occ.technician 
            0.9035196
> MAPE(res, u.big.tstY)
[1] 0.9175987
\end{verbatim}


\paragraph{A.2.5 movienum+usernum+gender$*$occ}

\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr3(u.big, c(1, 2, 9:27), 28, 
    c(29:48))), data = u.big.trn)
Coefficients:
                    (Intercept)                         movienum  
                      3.404e+00                       -6.280e-04  
                        usernum                          unknown  
                     -5.953e-06                       -3.073e-01  
                         Action                        Adventure  
                     -1.390e-01                        6.260e-02  
                      Animation                         Children  
                      3.082e-01                       -2.727e-01  
                         Comedy                            Crime  
                     -1.173e-01                       -1.483e-02  
                    Documentary                            Drama  
                      3.411e-01                        1.980e-01  
                        Fantasy                         FilmNoir  
                     -7.536e-02                        4.177e-01  
                         Horror                          Musical  
                     -1.726e-01                        1.875e-02  
                        Mystery                          Romance  
                      9.533e-02                        9.008e-02  
                          SciFi                         Thriller  
                     -1.351e-02                       -8.723e-03  
                            War                          Western  
                      1.918e-01                        1.185e-01  
                      dum_gen.F            dum_occ.administrator  
                      5.136e-01                        3.615e-01  
                 dum_occ.artist                   dum_occ.doctor  
                      6.371e-01                        4.929e-01  
               dum_occ.educator                 dum_occ.engineer  
                      4.508e-01                        3.389e-01  
          dum_occ.entertainment                dum_occ.executive  
                      2.743e-01                        1.517e-01  
             dum_occ.healthcare                dum_occ.homemaker  
                      4.449e-01                        2.940e-01  
                 dum_occ.lawyer                dum_occ.librarian  
                      5.399e-01                        3.214e-01  
              dum_occ.marketing                     dum_occ.none  
                      2.674e-01                        7.805e-01  
                  dum_occ.other               dum_occ.programmer  
                      3.834e-01                        4.010e-01  
                dum_occ.retired                 dum_occ.salesman  
                      2.919e-01                        2.262e-01  
              dum_occ.scientist                  dum_occ.student  
                      3.845e-01                        3.322e-01  
             dum_occ.technician  dum_gen.F:dum_occ.administrator  
                      3.365e-01                       -3.213e-01  
       dum_gen.F:dum_occ.artist         dum_gen.F:dum_occ.doctor  
                     -9.638e-01                               NA  
     dum_gen.F:dum_occ.educator       dum_gen.F:dum_occ.engineer  
                     -4.925e-01                       -3.686e-01  
dum_gen.F:dum_occ.entertainment      dum_gen.F:dum_occ.executive  
                     -5.271e-01                       -9.148e-02  
   dum_gen.F:dum_occ.healthcare      dum_gen.F:dum_occ.homemaker  
                     -1.315e+00                       -6.567e-01  
       dum_gen.F:dum_occ.lawyer      dum_gen.F:dum_occ.librarian  
                     -6.624e-01                       -4.710e-01  
    dum_gen.F:dum_occ.marketing           dum_gen.F:dum_occ.none  
                     -4.660e-01                       -7.941e-01  
        dum_gen.F:dum_occ.other     dum_gen.F:dum_occ.programmer  
                     -5.624e-01                       -5.515e-01  
      dum_gen.F:dum_occ.retired       dum_gen.F:dum_occ.salesman  
                     -7.605e-01                       -7.597e-02  
    dum_gen.F:dum_occ.scientist        dum_gen.F:dum_occ.student  
                     -9.140e-01                       -3.829e-01  
   dum_gen.F:dum_occ.technician  
                     -7.121e-01  
> MAPE(res, u.big.tstY)
[1] 0.8788762
\end{verbatim}

\paragraph{A.2.6 movienum+usernum+gender$*$genre}

\begin{verbatim}
    Call:
lm(formula = as.formula(indexToStr3(u.big, c(1, 2), 28, c(9:27))), 
    data = u.big.trn)
Coefficients:
          (Intercept)               movienum                usernum              dum_gen.F  
            3.771e+00             -6.598e-04             -3.415e-05              2.399e-02  
              unknown                 Action              Adventure              Animation  
           -3.673e-01             -1.420e-01              6.268e-02              3.331e-01  
             Children                 Comedy                  Crime            Documentary  
           -3.090e-01             -1.180e-01             -5.365e-03              3.198e-01  
                Drama                Fantasy               FilmNoir                 Horror  
            2.038e-01             -5.268e-02              4.587e-01             -1.612e-01  
              Musical                Mystery                Romance                  SciFi  
           -3.301e-03              1.199e-01              7.863e-02              9.563e-03  
             Thriller                    War                Western      dum_gen.F:unknown  
           -1.026e-02              2.068e-01              1.639e-01              2.535e-01  
     dum_gen.F:Action    dum_gen.F:Adventure    dum_gen.F:Animation     dum_gen.F:Children  
            7.405e-03              1.915e-02             -8.246e-02              1.240e-01  
     dum_gen.F:Comedy        dum_gen.F:Crime  dum_gen.F:Documentary        dum_gen.F:Drama  
            1.099e-02             -7.022e-02             -3.006e-03             -2.819e-02  
    dum_gen.F:Fantasy     dum_gen.F:FilmNoir       dum_gen.F:Horror      dum_gen.F:Musical  
           -3.886e-02             -1.571e-01             -6.662e-02              1.077e-01  
    dum_gen.F:Mystery      dum_gen.F:Romance        dum_gen.F:SciFi     dum_gen.F:Thriller  
           -8.023e-02              6.477e-02             -1.221e-01             -1.973e-03  
        dum_gen.F:War      dum_gen.F:Western  
           -5.603e-02             -2.185e-01  
> res <- predict(lmout, u.big.tstX)
> MAPE(res, u.big.tstY)
[1] 0.8899131
\end{verbatim}


\paragraph{A.2.7 movienum+usernum+age$*$genre}

\begin{verbatim}
    Call:
lm(formula = as.formula(indexToStr3(u.big, c(1, 2), 5, c(9:27))), 
    data = u.big.trn)
Coefficients:
    (Intercept)         movienum          usernum              age          unknown  
      3.557e+00       -6.552e-04       -2.046e-05        6.379e-03        1.135e+00  
         Action        Adventure        Animation         Children           Comedy  
     -6.392e-02        5.818e-02        4.540e-01       -1.426e-01       -8.473e-02  
          Crime      Documentary            Drama          Fantasy         FilmNoir  
      1.130e-01        5.600e-01        2.625e-01       -4.631e-01        2.540e-01  
         Horror          Musical          Mystery          Romance            SciFi  
      6.176e-02       -1.039e-02       -5.750e-02        2.328e-01        1.063e-01  
       Thriller              War          Western      age:unknown       age:Action  
      1.298e-02        1.027e-01       -1.573e-01       -5.160e-02       -2.170e-03  
  age:Adventure    age:Animation     age:Children       age:Comedy        age:Crime  
      1.848e-04       -4.454e-03       -3.740e-03       -8.154e-04       -4.027e-03  
age:Documentary        age:Drama      age:Fantasy     age:FilmNoir       age:Horror  
     -7.195e-03       -2.092e-03        1.222e-02        4.365e-03       -7.406e-03  
    age:Musical      age:Mystery      age:Romance        age:SciFi     age:Thriller  
      1.001e-03        4.413e-03       -4.045e-03       -3.641e-03       -6.871e-04  
        age:War      age:Western  
      2.436e-03        8.033e-03  
> res <- predict(lmout, u.big.tstX)
> MAPE(res, u.big.tstY)
[1] 0.8894089
\end{verbatim}

\paragraph{A.2.8 movienum+usernum+age*occ+gender*genre}

\begin{verbatim}
Call:
lm(formula = ttt, data = u.big.trn)
Coefficients:
              (Intercept)                   movienum                    usernum  
                2.860e+00                 -6.183e-04                 -1.977e-05  
                      age      dum_occ.administrator             dum_occ.artist  
                2.083e-02                  6.956e-01                  1.450e-01  
           dum_occ.doctor           dum_occ.educator           dum_occ.engineer  
                5.249e-01                  9.832e-01                  6.602e-01  
    dum_occ.entertainment          dum_occ.executive         dum_occ.healthcare  
                1.366e+00                 -4.587e-01                 -1.268e+00  
        dum_occ.homemaker             dum_occ.lawyer          dum_occ.librarian  
                4.836e-01                  9.787e-01                  7.098e-01  
        dum_occ.marketing               dum_occ.none              dum_occ.other  
                8.885e-01                  1.389e+00                  9.342e-01  
       dum_occ.programmer            dum_occ.retired           dum_occ.salesman  
                6.835e-01                  7.322e-01                  9.634e-01  
        dum_occ.scientist            dum_occ.student         dum_occ.technician  
                5.363e-01                  9.829e-01                  9.061e-01  
                dum_gen.F                    unknown                     Action  
                1.025e-01                 -3.156e-01                 -1.366e-01  
                Adventure                  Animation                   Children  
                6.279e-02                  3.425e-01                 -3.107e-01  
                   Comedy                      Crime                Documentary  
               -1.174e-01                  4.868e-03                  3.142e-01  
                    Drama                    Fantasy                   FilmNoir  
                2.055e-01                 -5.855e-02                  4.448e-01  
                   Horror                    Musical                    Mystery  
               -1.489e-01                 -6.519e-03                  1.158e-01  
                  Romance                      SciFi                   Thriller  
                7.795e-02                  1.866e-02                 -2.858e-03  
                      War                    Western  age:dum_occ.administrator  
                2.037e-01                  1.564e-01                 -1.453e-02  
       age:dum_occ.artist         age:dum_occ.doctor       age:dum_occ.educator  
                5.697e-03                 -6.617e-03                 -2.102e-02  
     age:dum_occ.engineer  age:dum_occ.entertainment      age:dum_occ.executive  
               -1.454e-02                 -4.054e-02                  1.112e-02  
   age:dum_occ.healthcare      age:dum_occ.homemaker         age:dum_occ.lawyer  
                1.868e-02                 -1.599e-02                 -1.830e-02  
    age:dum_occ.librarian      age:dum_occ.marketing           age:dum_occ.none  
               -1.716e-02                 -2.328e-02                 -2.947e-02  
        age:dum_occ.other     age:dum_occ.programmer        age:dum_occ.retired  
               -2.248e-02                 -1.319e-02                 -1.948e-02  
     age:dum_occ.salesman      age:dum_occ.scientist        age:dum_occ.student  
               -2.236e-02                 -1.086e-02                 -2.536e-02  
   age:dum_occ.technician          dum_gen.F:unknown           dum_gen.F:Action  
               -2.217e-02                  9.225e-02                  5.008e-03  
      dum_gen.F:Adventure        dum_gen.F:Animation         dum_gen.F:Children  
                1.409e-02                 -8.932e-02                  1.446e-01  
         dum_gen.F:Comedy            dum_gen.F:Crime      dum_gen.F:Documentary  
               -4.332e-03                 -8.323e-02                  6.643e-02  
          dum_gen.F:Drama          dum_gen.F:Fantasy         dum_gen.F:FilmNoir  
               -4.228e-02                 -2.829e-02                 -1.460e-01  
         dum_gen.F:Horror          dum_gen.F:Musical          dum_gen.F:Mystery  
               -4.064e-02                  7.797e-02                 -1.005e-01  
        dum_gen.F:Romance            dum_gen.F:SciFi         dum_gen.F:Thriller  
                4.069e-02                 -1.342e-01                 -2.011e-02  
            dum_gen.F:War          dum_gen.F:Western  
               -6.164e-02                 -1.941e-01
             
> MAPE(res, u.big.tstY)
[1] 0.874702
\end{verbatim}

\paragraph{A.2.9 movienum+usernum+age*genre+gender*occ}

\begin{verbatim}
Call:
lm(formula = ttt, data = u.big.trn)
Coefficients:
                    (Intercept)                         movienum  
                      3.100e+00                       -6.234e-04  
                        usernum                        dum_gen.F  
                      2.257e-06                        4.805e-01  
          dum_occ.administrator                   dum_occ.artist  
                      3.160e-01                        6.314e-01  
                 dum_occ.doctor                 dum_occ.educator  
                      4.720e-01                        3.755e-01  
               dum_occ.engineer            dum_occ.entertainment  
                      3.257e-01                        2.960e-01  
              dum_occ.executive               dum_occ.healthcare  
                      1.273e-01                        3.667e-01  
              dum_occ.homemaker                   dum_occ.lawyer  
                      3.437e-01                        5.277e-01  
              dum_occ.librarian                dum_occ.marketing  
                      2.869e-01                        2.336e-01  
                   dum_occ.none                    dum_occ.other  
                      8.583e-01                        3.775e-01  
             dum_occ.programmer                  dum_occ.retired  
                      3.990e-01                        1.081e-01  
               dum_occ.salesman                dum_occ.scientist  
                      2.116e-01                        3.643e-01  
                dum_occ.student               dum_occ.technician  
                      3.891e-01                        3.420e-01  
                            age                          unknown  
                      9.123e-03                        7.811e-01  
                         Action                        Adventure  
                     -6.955e-02                        5.086e-02  
                      Animation                         Children  
                      4.560e-01                       -1.753e-01  
                         Comedy                            Crime  
                     -9.557e-02                        1.202e-01  
                    Documentary                            Drama  
                      6.288e-01                        2.626e-01  
                        Fantasy                         FilmNoir  
                     -4.676e-01                        2.813e-01  
                         Horror                          Musical  
                      8.428e-02                       -1.437e-02  
                        Mystery                          Romance  
                     -5.170e-02                        2.232e-01  
                          SciFi                         Thriller  
                      1.111e-01                        3.831e-03  
                            War                          Western  
                      1.197e-01                       -1.149e-01  
dum_gen.F:dum_occ.administrator         dum_gen.F:dum_occ.artist  
                     -2.767e-01                       -8.941e-01  
       dum_gen.F:dum_occ.doctor       dum_gen.F:dum_occ.educator  
                             NA                       -4.182e-01  
     dum_gen.F:dum_occ.engineer  dum_gen.F:dum_occ.entertainment  
                     -3.298e-01                       -4.860e-01  
    dum_gen.F:dum_occ.executive     dum_gen.F:dum_occ.healthcare  
                     -9.964e-02                       -1.237e+00  
    dum_gen.F:dum_occ.homemaker         dum_gen.F:dum_occ.lawyer  
                     -6.811e-01                       -6.284e-01  
    dum_gen.F:dum_occ.librarian      dum_gen.F:dum_occ.marketing  
                     -4.304e-01                       -3.965e-01  
         dum_gen.F:dum_occ.none          dum_gen.F:dum_occ.other  
                     -8.475e-01                       -5.198e-01  
   dum_gen.F:dum_occ.programmer        dum_gen.F:dum_occ.retired  
                     -5.128e-01                       -7.796e-01  
     dum_gen.F:dum_occ.salesman      dum_gen.F:dum_occ.scientist  
                     -2.314e-02                       -8.402e-01  
      dum_gen.F:dum_occ.student     dum_gen.F:dum_occ.technician  
                     -3.419e-01                       -7.240e-01  
                    age:unknown                       age:Action  
                     -3.823e-02                       -1.954e-03  
                  age:Adventure                    age:Animation  
                      2.885e-04                       -4.522e-03  
                   age:Children                       age:Comedy  
                     -2.856e-03                       -5.350e-04  
                      age:Crime                  age:Documentary  
                     -4.027e-03                       -8.413e-03  
                      age:Drama                      age:Fantasy  
                     -2.018e-03                        1.217e-02  
                   age:FilmNoir                       age:Horror  
                      3.433e-03                       -7.941e-03  
                    age:Musical                      age:Mystery  
                      9.112e-04                        4.129e-03  
                    age:Romance                        age:SciFi  
                     -4.009e-03                       -3.717e-03  
                   age:Thriller                          age:War  
                     -3.141e-04                        1.946e-03  
                    age:Western  
                      6.771e-03    
> res <- predict(lmout, u.big.tstX)
> MAPE(res, u.big.tstY)
[1] 0.8766665
\end{verbatim}

\paragraph{A.2.10 movienum+usernum+age*genre+gender*occ(filtered)}
\begin{verbatim}
Call:
lm(formula = as.formula(indexToStr4(tmp1)), data = u.big.trn)
Coefficients:
          (Intercept)               movienum                usernum                    age
            3.137e+00             -6.179e-04             -6.961e-06              6.519e-03
            dum_gen.F  dum_occ.administrator         dum_occ.artist         dum_occ.doctor
            4.693e-02              3.148e-01              3.864e-01              4.282e-01
     dum_occ.educator       dum_occ.engineer  dum_occ.entertainment      dum_occ.homemaker
            3.251e-01              2.672e-01              2.317e-01              6.143e-02
       dum_occ.lawyer      dum_occ.librarian      dum_occ.marketing           dum_occ.none
            4.603e-01              2.406e-01              1.842e-01              6.319e-01
        dum_occ.other     dum_occ.programmer        dum_occ.retired       dum_occ.salesman
            2.923e-01              3.331e-01              3.315e-02              3.145e-01
    dum_occ.scientist        dum_occ.student     dum_occ.technician              Animation
            2.828e-01              3.581e-01              2.743e-01              1.853e-01
          Documentary                  Drama               FilmNoir                Mystery
            4.143e-01              2.784e-01              4.887e-01              1.268e-01
                  War                Western     dum_gen.F:Children
            2.126e-01              1.091e-01             -5.541e-02
> res <- predict(lmout, u.big.tstX)
> MAPE(res, u.big.tstY)
[1] 0.8879195
\end{verbatim}
\end{document}